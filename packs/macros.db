{"name":"Change XP Bars","type":"script","author":"FIR7wPEGx1wVISuV","img":"icons/sundries/misc/lock-open-yellow.webp","scope":"global","command":"const version = '1.0';\n\n/*\nhttps://raw.githubusercontent.com/brunocalado/mestre-digital/master/Foundry%20VTT/Macros/Forged%20in%20the%20Dark/BladesintheDark-XpBar.js\nicon: icons/sundries/misc/lock-open-yellow.webp\n*/\n\nif (canvas.tokens.controlled[0]===undefined){\n  ui.notifications.warn(\"You must select a token!\");    \n} else {\n  main();\n}\n\nasync function main() {\n  let attribute = [];\n  if(canvas.tokens.controlled[0].actor.type === 'character'){\n    attribute = Object.keys( game.system.model.Actor.character.attributes );\n    attribute.push(\"class\");\n  } else if(canvas.tokens.controlled[0].actor.type === 'ship'){\n    attribute = [\"crew\"];\n  }\n\n  let attributeList = ``;\n  attribute.map((t) => {\n    attributeList += `<option value=\"${t}\">${t}</option>`;\n  });\n  \n  new Dialog({\n    title: `XP Bar - Manager - v${version}`,\n    content: `\n    <h2>XP Bar Size</h2>\n    <p>      \n      <input type=\"number\" min=1 max=12 id=\"xpBarSize\" value=\"6\"/>\n    </p><br>\n    <h2>Choose the Experience Bar</h2>\n    <p>    \n      <select id=\"attribute\" type=\"text\" style=\"width: 100px;\">\n        ${attributeList}\n      </select>  \n    </p>    \n    `,\n    buttons: {\n      roll: {\n        label: \"Change\",\n        callback: (html) => {\n          createImageFolder(html);\n        }\n      }, \n      cancel: {\n        label: \"Cancel\"\n      }\n    }\n  }).render(true)\n}\n\nasync function createImageFolder(html) {\n  const xpBarSize = parseInt( html.find(\"#xpBarSize\")[0].value );  \n  let attribute = html.find(\"#attribute\")[0].value;  \n \n  let tokenD = canvas.tokens.controlled[0].actor;\n  \n  //attribute=''\n  if (attribute==='class') {\n    let updated = await Actor.updateDocuments([{_id: tokenD.id, \"data.experienceMax\": xpBarSize}]);\n  } else if (attribute==='crew') {\n    let updated = await Actor.updateDocuments([{_id: tokenD.id, \"data.crew_experienceMax\": xpBarSize}]);\n  } else {\n    let key = \"data.attributes.\" + attribute + \".expMax\"; \n    let updated = await Actor.updateDocuments([{_id: tokenD.id, [key]: xpBarSize}]);\n  }\n}","folder":null,"sort":0,"permission":{"default":0,"FIR7wPEGx1wVISuV":3},"flags":{"advanced-macros":{"runAsGM":false},"exportSource":{"world":"sav","system":"scum-and-villainy","coreVersion":"0.8.9","systemVersion":"1.9.4"},"core":{"sourceId":"Macro.R5S30v5UU19PIynf"}},"_id":"RyYkJhE6XhRiv6aG"}
